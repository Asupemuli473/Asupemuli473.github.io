<html>
  <head>
    <title>Edit canvas</title>

    <script type="text/javascript">
      var cur_drawing_ctx = -1;

      function start_path(event){
	  if(event.type=='touchstart'){
	      event.preventDefault();
	  }
	  cur_drawing_ctx = event.target.getContext("2d");
	  cur_drawing_ctx.beginPath();
	  cur_drawing_ctx.lineWidth = 3;
	  cur_drawing_ctx.strokeStyle = "#000000";
	  if(event.type=='touchstart'){
	      cur_drawing_ctx.moveTo(event.layerX, event.layerY);
	  }
	  else{
	      cur_drawing_ctx.moveTo(event.layerX-event.target.offsetLeft, event.layerY-event.target.offsetTop);
	  }
      }

      function draw_to_new_point(event){
	  if(event.type=='touchmove'){
	      event.preventDefault();
	  }
	  if(cur_drawing_ctx!=-1){
	      if(event.type=='touchmove'){
		  cur_drawing_ctx.lineTo(event.layerX, event.layerY);
	      }
	      else{
		  cur_drawing_ctx.lineTo(event.layerX-event.target.offsetLeft, event.layerY-event.target.offsetTop);
	      }
	      cur_drawing_ctx.stroke();
	  }
      }
      
      function end_path(event){
	  cur_drawing_ctx.stroke();
	  cur_drawing_ctx = -1;
      }
    </script>
</head>
  <body>
    <canvas id="ed_canvas" width="100%" height="100%"></canvas>
    <script>
      var queryString = decodeURIComponent(window.location.search);
      queryString = queryString.substring(1);
      var queries = queryString.split("&");

      var c = document.getElementById("ed_canvas");

      c.addEventListener("mousedown", start_path);
      c.addEventListener("mousemove", draw_to_new_point);
      c.addEventListener("mouseup", end_path);

      c.addEventListener("touchstart", start_path);
      c.addEventListener("touchmove", draw_to_new_point);
      c.addEventListener("touchend", end_path);
      
      var ctx = c.getContext('2d');
      ctx.drawImage(queries[0],0,0);
    </script>

</body>
</html>
