<html>
  <head>
    <title>note4u</title>
    <link rel="stylesheet" type="text/css" href="style.css">
    <script type="text/javascript">
      var num_text = 0;
      var num_picture = 0;
      var num_video = 0;
      var num_canvas = 0;


      var cur_drawing_ctx = -1;

      function add(type){
	  var elem;
	  var id;
	  
	  switch(type){
	  case 'text':
	      elem = document.createElement("textarea"); 
	      elem.setAttribute("placeholder","Enter text here");
	      elem.setAttribute("id", "text_".concat(num_text++));
	      break;
	  case 'picture':
	      elem = document.createElement("input");
	      elem.setAttribute("id", "picture_".concat(num_picture++));
	      elem.setAttribute("type", "file");
	      elem.setAttribute("accept", "image/*");
	      elem.setAttribute("capture", "camera");
	      elem.setAttribute("onchange", "change_image(this)");
	      break;
	  case 'video':
	      elem = document.createElement("input"); 
	      elem.setAttribute(id, "video_".concat(num_video++));
	      // elem.setAttribute("onchange", "fct");  TODO
	      elem.setAttribute("type", "file");
	      elem.setAttribute("accept", "video/*");
	      elem.setAttribute("capture", "camera");
	      elem.setAttribute("onchange", "change_video(this)");
	      break
	  case 'canvas':
	      elem = document.createElement("canvas");
	      elem.setAttribute("id", "canvas_".concat(num_canvas++));
	      var w = document.body.clientWidth*0.9;
	      var h = document.body.clientHeight*0.3;
	      elem.setAttribute("width", w);
	      elem.setAttribute("height", h);
	      elem.addEventListener("mousedown", start_path);
	      elem.addEventListener("mousemove", draw_to_new_point);
	      elem.addEventListener("mouseup", end_path);
	      
	      elem.addEventListener("touchstart", start_path);
	      elem.addEventListener("touchmove", draw_to_new_point);
	      elem.addEventListener("touchend", end_path);
	      break;
	  }
 	  
	  var p = document.createElement("p");
	  p.appendChild(elem);
	  

	  var div = document.getElementById("notes");
	  div.appendChild(p);
      }

      function change_image(e){
	  var pic_url = URL.createObjectURL(e.files[0]);
	  var id_of_img_tag = e.id.concat("_img");
	  var elem = document.getElementById(id_of_img_tag);
	  if(!elem){
	      elem = document.createElement("img");
	      elem.setAttribute("id", id_of_img_tag);
	      elem.setAttribute("alt", "image");
	      insertAfter(elem, e);
	  }
	  elem.setAttribute("src", pic_url);
      }

      function change_video(e){
	  var vid_url = URL.createObjectURL(e.files[0]);
	  var id_of_vid_tag = e.id.concat("_vid");
	  var elem = document.getElementById(id_of_vid_tag);
	  if(!elem){
	      elem = document.createElement("video");
	      elem.setAttribute("id", id_of_vid_tag);
	      elem.setAttribute("controls","");
	      insertAfter(elem, e);
	  }
	  elem.setAttribute("src", vid_url);
      }

      function insertAfter(el, referenceNode){
	  referenceNode.parentNode.insertBefore(el, referenceNode.nextSibling);
      }

      function start_path(event){
	  if(event.type=='touchstart'){
	      event.preventDefault();
	  }
	  cur_drawing_ctx = event.target.getContext("2d");
	  document.getElementById("debug").innerHTML = "Client:</br>"
	  document.getElementById("debug").innerHTML += "clicked at (without subtracting): ".concat(event.clientX,", ",event.clientY);
	  	  document.getElementById("debug").innerHTML += "</br>clicked at (with subtracting): ".concat(event.clientX-event.target.offsetLeft,", ",event.clientY-event.target.offsetTop);
	  document.getElementById("debug").innerHTML += "</br>Layer:</br>"
	  document.getElementById("debug").innerHTML += "clicked at (without subtracting): ".concat(event.layerX,", ",event.layerY);
	  	  document.getElementById("debug").innerHTML += "</br>clicked at (with subtracting): ".concat(event.layerX-event.target.offsetLeft,", ",event.layerY-event.target.offsetTop);
	  document.getElementById("debug").innerHTML += "</br>offsetleft: ".concat(event.target.offsetLeft, ", top: ", event.target.offsetTop);
	  cur_drawing_ctx.beginPath();
	  cur_drawing_ctx.lineWidth = 3;
	  cur_drawing_ctx.strokeStyle = "#000000";
	  cur_drawing_ctx.moveTo(event.layerX-event.target.offsetLeft, event.layerY-event.target.offsetTop);
      }

      function draw_to_new_point(event){
	  if(event.type=='touchmove'){
	      event.preventDefault();
	  }
	  if(cur_drawing_ctx!=-1){
	      cur_drawing_ctx.lineTo(event.layerX-event.target.offsetLeft, event.layerY-event.target.offsetTop);
	      cur_drawing_ctx.stroke();
	  }
      }

      function end_path(event){
	  cur_drawing_ctx.stroke();
	  cur_drawing_ctx = -1;
      }

    </script>
</head>
<body>
  <header>
    <h1>Note4u</h1>
  </header>
  <section>
    <article><p>This website lets you create notes. There are different kinds of note:
    <ul>
      <li><b>Canvas note</b>: allows you to freely draw something</li>
      <li><b>Picture note</b>: allows you to take a picture</li>
      <li><b>Video note</b>: allows you to record a video</li>
      <li><b>Text note</b>: allows you to create a textual note</li>
    </ul>
    You can add them via click on the buttons below, just try it. After you're done, you can download them.</p>
      <p id="debug">Text</p>
      <div id="notes">
      </div>
    </article>
    <footer>
      <button type="button" onclick="add('canvas')">Canvas note </button>
      <button type="button" onclick="add('picture')">Picture node</button>
      <button type="button" onclick="add('video')">Video note</button>
      <button type="button" onclick="add('text')">Text note</button>
    </footer>
  </section>
  <footer>
    <button type="button" onclick="download_data()">Download note</button>
  </footer>
</body>

</html>
